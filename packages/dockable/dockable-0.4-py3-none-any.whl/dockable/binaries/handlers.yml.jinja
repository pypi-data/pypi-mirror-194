name: releases-internal
steps:
- run:
  - wget {{ url }}/{{ filename }} -P /tmp/download
  {% if "filename" in kwargs and filename.endswith('tar.gz') %}
  - tar -zxvf /tmp/download/{{ filename }} -C /tmp/download
  {% endif %}
  - mv /tmp/download/{{ path if 'path' in kwargs else name }} /usr/local/bin/{{ name }}
  - chmod 755 /usr/local/bin/{{ name }}
  - rm -rf /tmp/download
  needs:
  - dockable.builtin.apt:
      pkg:
      - ca-certificates
      - wget
---
name: kubectl
steps:
- .releases-internal:
    url: https://dl.k8s.io/release/v{{ version }}/bin/{{ os }}/{{ arch }}
    filename: kubectl
    name: kubectl
---
name: helm
steps:
- .releases-internal:
    url: https://get.helm.sh
    filename: helm-v{{ version }}-{{ os }}-{{ arch }}.tar.gz
    path: {{ os }}-{{ arch }}/helm
    name: helm
---
name: kustomize
steps:
- .releases-internal:
    url: https://github.com/kubernetes-sigs/kustomize/releases/download/kustomize/v{{ version }}
    filename: kustomize_v{{ version }}_{{ os }}_{{ arch }}.tar.gz
    name: kustomize
---
name: helmfile
steps:
- .releases-internal:
    url: https://github.com/helmfile/helmfile/releases/download/v{{ version }}
    filename: helmfile_{{ version }}_{{ os }}_{{ arch }}.tar.gz
    name: helmfile
---
name: krew
steps:
- .releases-internal:
    url: https://github.com/kubernetes-sigs/krew/releases/download/v{{ version }}
    filename: krew-{{ os }}_{{ arch }}.tar.gz
    path: krew-{{ os }}_{{ arch }}
    name: krew
---
name: kubeseal
steps:
- .releases-internal:
    url: https://github.com/bitnami-labs/sealed-secrets/releases/download/v{{ version }}
    filename: kubeseal-{{ version }}-{{ os }}-{{ arch }}.tar.gz
    name: kubeseal
---
name: releases
steps:
- parallel:
  {% for x in pkg %}
  - "dockable.binaries.{{ x.name }}":
        version: {{ x.version }}
        os: linux
        arch: amd64
  {% endfor %}
