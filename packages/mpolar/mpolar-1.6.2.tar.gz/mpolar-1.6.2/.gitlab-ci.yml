stages:
  - test
  - deploy

test:
  stage: test
  image: ubuntu:20.04
  allow_failure: false
  before_script:
    - apt-get update -y
    - apt-get install -y python3 python3-pip python-is-python3
  script:
    - pip install -r requirements.txt
    - python -m unittest test.test_parse

deploy:
  stage: deploy
  image: ubuntu:20.04
  allow_failure: false
  when: on_success
  only:
    - tags
  before_script:
    - apt-get update -y
    - apt-get install -y python3 python3-pip python-is-python3 python3-venv git
  script:
    - pip install --upgrade setuptools
    # build
    - pip install -q build
    - python -m build
    # upload
    - pip install twine
    - twine upload dist/*