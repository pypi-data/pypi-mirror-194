"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6532],{86532:function(n,e,t){t.d(e,{Z:function(){return J}});var o,i=t(21831),r=t(82394),u=t(75582),c=t(77837),l=t(38860),d=t.n(l),a=t(51774),s=t.n(a),v=t(9518),f=t(4804),p=t(82684),h=t(83455),m=t(86422),b=t(67971),k=t(16634),g=t(86673),y=t(54283),x=t(19711),C=t(23831),E=t(10503),O=t(49125),j=(O.iI,{height:10,width:10}),w=[m.tf.DATA_EXPORTER,m.tf.SENSOR],P=[m.Lq.GREY,m.Lq.PINK,m.Lq.TEAL,m.Lq.YELLOW];!function(n){n.NORTH="NORTH",n.SOUTH="SOUTH"}(o||(o={}));var A=t(73942),D=t(37391),I=v.default.div.withConfig({displayName:"indexstyle__GraphContainerStyle",componentId:"sc-bc2ei5-0"})(["div:only-child{","}",""],D.w5,(function(n){return n.height&&"\n    height: ".concat(n.height,"px;\n  ")})),T=v.default.div.withConfig({displayName:"indexstyle__NodeStyle",componentId:"sc-bc2ei5-1"})(["border-radius:","px;border:1px solid transparent;min-width:fit-content;"," "," "," ",""],A.BG,(function(n){return n.selected&&"\n    border-color: ".concat((n.theme.content||C.Z.content).active,";\n  ")}),(function(n){return n.backgroundColor&&"\n    background-color: ".concat(n.backgroundColor,";\n  ")}),(function(n){return(n.isCancelled||n.disabled)&&"\n    // opacity doesn\u2019t work on Safari\n    border-color: ".concat((n.theme.content||C.Z.content).active,";\n    border-style: dashed;\n    cursor: not-allowed;\n  ")}),(function(n){return n.disabled&&"\n    &:hover {\n      cursor: not-allowed;\n    }\n  "})),Z=v.default.div.withConfig({displayName:"indexstyle__RuntimeStyle",componentId:"sc-bc2ei5-2"})(["margin-right:","px;padding:12px 4px;height:100%;width:50px;background:rgba(0,0,0,0.2);background-blend-mode:soft-light;"],2*O.iI),N=t(44162),_=t(90211),R=function(n){var e=n/1e3,t=4-Math.floor(e).toString().length,o=(0,_.QV)(e,t>=0?t:0),i="s";return o>1e3&&(o=(0,_.QV)(o/60,0),i="m"),"".concat(o).concat(i)},S=function(n,e){var t=n||{},i=t.id,r=t.side,u=null===e||void 0===e?void 0:e.id;return r===o.NORTH?null===i||void 0===i?void 0:i.endsWith("".concat(u,"-to")):r===o.SOUTH&&(null===i||void 0===i?void 0:i.startsWith(u))},B=t(28598);var L=function(n){var e=n.block,t=n.children,o=n.disabled,i=n.hasFailed,r=n.isCancelled,u=n.isInProgress,c=n.isQueued,l=n.isSuccessful,d=(n.onClick,n.runtime),a=n.selected,s=(0,p.useContext)(v.ThemeContext),f=e.color,h=e.type,m=e.uuid,j=!(u||c||i||l||r),A=l&&!(u||c),D=i&&!(u||c),I="";return j?I="No status":A?I="Successful execution":D?I="Failed execution":u?I="Currently executiing":r&&(I="Cancelled execution"),(0,B.jsx)(T,{backgroundColor:(0,N.qn)(h,{blockColor:f,theme:s}).accent,disabled:o,isCancelled:r,selected:a,children:(0,B.jsxs)(b.Z,{alignItems:"center",children:[d&&(0,B.jsx)(Z,{backgroundColor:(0,N.qn)(h,{blockColor:f,theme:s}).accent,children:(0,B.jsx)(b.Z,{justifyContent:"center",children:(0,B.jsx)(x.ZP,{inverted:w.includes(h)||P.includes(f),xsmall:!0,children:R(d)})})}),!d&&(0,B.jsx)(g.Z,{ml:2}),(0,B.jsxs)(b.Z,{alignItems:"center",justifyContent:"center",style:{height:2*O.iI,width:2*O.iI},title:I,children:[u&&(0,B.jsx)(y.Z,{color:(s||C.Z).content.active,small:!0}),A&&(0,B.jsx)(E.Jr,{size:2*O.iI,success:!0}),D&&(0,B.jsx)(E.x8,{danger:!0,size:1.5*O.iI}),j&&(0,B.jsx)(k.Z,{borderSize:1,size:1*O.iI})]}),(0,B.jsx)(g.Z,{ml:1}),(0,B.jsx)(b.Z,{alignItems:"center",justifyContent:"center",style:{padding:"8px 0",height:"100%"},children:(0,B.jsx)(x.ZP,{inverted:w.includes(h)||P.includes(f),monospace:!0,small:!0,children:t})})]})},m)},U=t(11135),H=t(98781),M=t(82531),G=t(66050),q=t(24224),F=t(25958),V=t(96510),K=t(87323);function Q(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,o)}return t}function X(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?Q(Object(t),!0).forEach((function(e){(0,r.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Q(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var z=s()((0,c.Z)(d().mark((function n(){var e;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Promise.all([t.e(4434),t.e(5987),t.e(3873)]).then(t.t.bind(t,74529,23));case 2:return e=n.sent,n.abrupt("return",e.Canvas);case 4:case"end":return n.stop()}}),n)}))),{ssr:!1,loadableGenerated:{webpack:function(){return[74529]}}}),W=s()((0,c.Z)(d().mark((function n(){var e;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Promise.all([t.e(4434),t.e(5987),t.e(3873)]).then(t.t.bind(t,74529,23));case 2:return e=n.sent,n.abrupt("return",e.Node);case 4:case"end":return n.stop()}}),n)}))),{ssr:!1,loadableGenerated:{webpack:function(){return[74529]}}}),Y=s()((0,c.Z)(d().mark((function n(){var e;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Promise.all([t.e(4434),t.e(5987),t.e(3873)]).then(t.t.bind(t,74529,23));case 2:return e=n.sent,n.abrupt("return",e.Edge);case 4:case"end":return n.stop()}}),n)}))),{ssr:!1,loadableGenerated:{webpack:function(){return[74529]}}}),$=(s()((0,c.Z)(d().mark((function n(){var e;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Promise.all([t.e(4434),t.e(5987),t.e(3873)]).then(t.t.bind(t,74529,23));case 2:return e=n.sent,n.abrupt("return",e.MarkerArrow);case 4:case"end":return n.stop()}}),n)}))),{ssr:!1,loadableGenerated:{webpack:function(){return[74529]}}}),s()((0,c.Z)(d().mark((function n(){var e;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Promise.all([t.e(4434),t.e(5987),t.e(3873)]).then(t.t.bind(t,74529,23));case 2:return e=n.sent,n.abrupt("return",e.Port);case 4:case"end":return n.stop()}}),n)}))),{ssr:!1,loadableGenerated:{webpack:function(){return[74529]}}}));var J=function(n){var e=n.blockRefs,t=n.blockStatus,r=n.editingBlock,c=n.enablePorts,l=void 0!==c&&c,d=n.fetchPipeline,a=n.height,s=n.heightOffset,k=void 0===s?10*O.iI:s,y=n.noStatus,C=n.pipeline,E=n.runningBlocks,w=void 0===E?[]:E,P=n.selectedBlock,A=n.setEditingBlock,D=n.setErrors,T=n.setSelectedBlock,Z=n.showDynamicBlocks,_=void 0!==Z&&Z,R=(0,p.useContext)(v.ThemeContext),Q=(0,p.useState)([]),J=Q[0],nn=Q[1],en=(0,p.useState)(!1),tn=en[0],on=en[1],rn=(0,p.useState)(null),un=rn[0],cn=rn[1],ln=l&&tn,dn=(null===r||void 0===r?void 0:r.upstreamBlocks)||{},an=dn.block,sn=dn.values,vn=void 0===sn?[]:sn,fn=(0,p.useMemo)((function(){return vn.length}),[vn]),pn=(0,p.useMemo)((function(){var n;return(null===C||void 0===C||null===(n=C.blocks)||void 0===n?void 0:n.filter((function(n){var e=n.type;return m.tf.SCRATCHPAD!==e})))||[]}),[null===C||void 0===C?void 0:C.blocks]),hn=(0,q.HK)((0,K.cU)(pn,pn),(function(n){return n.block.uuid})),mn=(0,p.useMemo)((function(){return pn}),[pn,hn,_]),bn=(0,p.useMemo)((function(){return(0,q.HK)(mn,(function(n){return n.uuid}))}),[mn]),kn=(0,p.useMemo)((function(){return(0,q.HK)(w,(function(n){return n.uuid}))}),[w]),gn=(0,h.Db)(M.ZP.blocks.pipelines.useUpdate(null===C||void 0===C?void 0:C.uuid,encodeURIComponent(null===an||void 0===an?void 0:an.uuid)),{onSuccess:function(n){return(0,V.wD)(n,{callback:function(){A({upstreamBlocks:null}),null===d||void 0===d||d()},onErrorCallback:function(n,e){return null===D||void 0===D?void 0:D({errors:e,response:n})}})}}),yn=(0,u.Z)(gn,2),xn=yn[0],Cn=yn[1].isLoading,En=(0,h.Db)((function(n){var e=n.fromBlock,t=n.toBlock,o=n.removeDependency;return M.ZP.blocks.pipelines.useUpdate(null===C||void 0===C?void 0:C.uuid,encodeURIComponent(t.uuid))({block:X(X({},t),{},{upstream_blocks:o?t.upstream_blocks.filter((function(n){return n!==e.uuid})):t.upstream_blocks.concat(e.uuid)})})}),{onSuccess:function(n){return(0,V.wD)(n,{callback:function(){null===d||void 0===d||d()},onErrorCallback:function(n,e){return null===D||void 0===D?void 0:D({errors:e,response:n})}})}}),On=(0,u.Z)(En,1)[0],jn=(0,p.useCallback)((function(n){var t=n.type,o=n.uuid;if(null===T||void 0===T||T(n),nn([]),null!==e&&void 0!==e&&e.current){var i,r=e.current["".concat(t,"s/").concat(o,".py")];null===r||void 0===r||null===(i=r.current)||void 0===i||i.scrollIntoView()}}),[e,T]),wn=(0,p.useCallback)((function(n){nn([]),A((function(e){var t=e.upstreamBlocks.values||[],o=t.findIndex((function(e){var t=e.uuid;return n.uuid===t}));return X(X({},e),{},{upstreamBlocks:X(X({},e.upstreamBlocks),{},{values:o>=0?(0,q.oM)(t,o):t.concat(n)})})}))}),[A]),Pn=(0,p.useMemo)((function(){var n={};return mn.forEach((function(e){e.upstream_blocks.forEach((function(t){n[t]||(n[t]=[]),n[t].push(e)}))})),n}),[mn]),An=(0,p.useCallback)((function(n){var e;if(H.q.INTEGRATION===(null===C||void 0===C?void 0:C.type)&&m.tf.TRANSFORMER!==n.type){var t,o={};if(m.t6.YAML===n.language&&(o=(0,f.Qc)(n.content)),m.tf.DATA_LOADER===n.type)e="".concat(n.uuid,": ").concat(null===(t=o)||void 0===t?void 0:t.source);else if(m.tf.DATA_EXPORTER===n.type){var i;e="".concat(n.uuid,": ").concat(null===(i=o)||void 0===i?void 0:i.destination)}}else m.tf.DBT===n.type&&m.t6.SQL===n.language&&(e=(0,F.$)(n,{fullPath:!0}));var r=(null===hn||void 0===hn?void 0:hn[n.uuid])||{},u=r.dynamic,c=r.dynamicUpstreamBlock,l=(r.reduceOutput,r.reduceOutputUpstreamBlock);return e||(e=n.uuid,u?e="[dynamic] ".concat(e):c&&!l&&(e="[dynamic child] ".concat(e))),e}),[hn,C]),Dn=(0,p.useMemo)((function(){var n=[],e=[];return mn.forEach((function(r){var u,c=An(r),l=r.type,d=r.upstream_blocks,a=void 0===d?[]:d,s=r.uuid,v=Pn[s],f=[];v?f.push.apply(f,(0,i.Z)(v.map((function(n){return X(X({},j),{},{id:"".concat(s,"-").concat(n.uuid,"-from"),side:o.SOUTH})})))):l!==m.tf.DATA_EXPORTER&&f.push(X(X({},j),{},{id:"".concat(s,"-from"),side:o.SOUTH})),0===a.length&&l!==m.tf.DATA_LOADER&&f.push(X(X({},j),{},{id:"".concat(s,"-to"),side:o.NORTH})),null===a||void 0===a||a.forEach((function(n){f.push(X(X({},j),{},{id:"".concat(n,"-").concat(s,"-to"),side:o.NORTH})),e.push({from:n,fromPort:"".concat(n,"-").concat(s,"-from"),id:"".concat(n,"-").concat(s),to:s,toPort:"".concat(n,"-").concat(s,"-to")})})),n.push({data:{block:r},height:37,id:s,ports:f,width:c.length*O.KF+5*O.iI+((null===an||void 0===an?void 0:an.uuid)===r.uuid?19*O.KF:0)+(null!==t&&void 0!==t&&null!==(u=t[r.uuid])&&void 0!==u&&u.runtime?50:0)})})),{edges:e,nodes:n}}),[null===an||void 0===an?void 0:an.uuid,t,mn,An,Pn]),In=Dn.edges,Tn=Dn.nodes,Zn=(0,p.useCallback)((function(n){if(y)return{};if(t){var e=t[n.uuid]||{},o=e.status,i=e.runtime;return{hasFailed:G.V.FAILED===o,isCancelled:G.V.CANCELLED===o,isInProgress:G.V.RUNNING===o,isQueued:G.V.INITIAL===o,isSuccessful:G.V.COMPLETED===o,runtime:i}}var r;return{hasFailed:m.DA.FAILED===n.status,isInProgress:kn[n.uuid],isQueued:kn[n.uuid]&&(null===(r=w[0])||void 0===r?void 0:r.uuid)!==n.uuid,isSuccessful:m.DA.EXECUTED===n.status}}),[kn,t]);return(0,B.jsxs)(B.Fragment,{children:[an&&(0,B.jsxs)(g.Z,{my:3,px:O.cd,children:[(0,B.jsxs)(g.Z,{mb:O.cd,children:[(0,B.jsxs)(x.ZP,{children:["Select parent block(s) for ",(0,B.jsx)(x.ZP,{color:(0,N.qn)(an.type,{blockColor:an.color,theme:R}).accent,inline:!0,monospace:!0,children:an.uuid}),":"]}),(0,B.jsx)(g.Z,{mt:1,children:vn.map((function(n,e){var t,o,i=n.uuid;return(0,B.jsxs)(x.ZP,{color:(0,N.qn)(null===(t=bn[i])||void 0===t?void 0:t.type,{blockColor:null===(o=bn[i])||void 0===o?void 0:o.type,theme:R}).accent,inline:!0,monospace:!0,children:[i,fn>=2&&e<=fn-2?(0,B.jsx)(x.ZP,{inline:!0,children:",\xa0"}):null]},i)}))})]}),(0,B.jsxs)(b.Z,{alignItems:"center",children:[(0,B.jsx)(U.ZP,{compact:!0,inline:!0,loading:Cn,onClick:function(){return xn({block:X(X({},an),{},{upstream_blocks:vn.map((function(n){return n.uuid}))})})},uuid:"DependencyGraph/save_parents",children:"Save dependencies"}),(0,B.jsx)(g.Z,{ml:1}),(0,B.jsx)(U.ZP,{compact:!0,inline:!0,noBackground:!0,onClick:function(){nn([]),A({upstreamBlocks:null})},uuid:"DependencyGraph/cancel_save_parents",children:"Cancel"})]})]}),(0,B.jsx)(I,{height:a-k,children:(0,B.jsx)(z,{arrow:null,disabled:!1,edge:function(n){var e,t=bn[n.source];return(0,B.jsx)(Y,X(X({},n),{},{onClick:function(n,e){cn(null),nn([e.id])},onRemove:function(n,e){var t=bn[e.from],o=bn[e.to];On({fromBlock:t,removeDependency:!0,toBlock:o}),nn([])},removable:l&&!(null!==r&&void 0!==r&&r.upstreamBlocks),style:{stroke:null===(e=(0,N.qn)(null===t||void 0===t?void 0:t.type,{blockColor:null===t||void 0===t?void 0:t.color,theme:R}))||void 0===e?void 0:e.accent}}))},edges:In,fit:!0,node:function(n){var e,t,o,i,u,c;return(0,B.jsx)(W,X(X({},n),{},{dragType:"port",linkable:!0,onClick:function(n,e){var t=e.data.block;cn(null),(null===an||void 0===an?void 0:an.uuid)===t.uuid||(an?wn(t):jn(t))},onEnter:function(){null!==r&&void 0!==r&&r.upstreamBlocks||on(!0)},onLeave:function(){return on(!1)},port:ln&&(null===un||S(un,n))?(0,B.jsx)($,{onDrag:function(){return on(!0)},onDragEnd:function(){on(!1),cn(null)},onDragStart:function(n,e,t){cn({id:null===t||void 0===t?void 0:t.id,side:null===t||void 0===t?void 0:t.side})},onEnter:function(){return on(!0)},rx:10,ry:10,style:{fill:(0,N.qn)(null===n||void 0===n||null===(e=n.properties)||void 0===e||null===(t=e.data)||void 0===t||null===(o=t.block)||void 0===o?void 0:o.type,{blockColor:null===n||void 0===n||null===(i=n.properties)||void 0===i||null===(u=i.data)||void 0===u||null===(c=u.block)||void 0===c?void 0:c.color,theme:R}).accent,stroke:"white",strokeWidth:"1px"}}):null,style:{fill:"transparent",stroke:"transparent",strokeWidth:0},children:function(n){var e=n.node.data.block,t=Zn(e);return(0,B.jsx)("foreignObject",{height:n.height,style:{pointerEvents:"none"},width:n.width,x:0,y:0,children:(0,B.jsxs)(L,X(X({block:e,disabled:(null===an||void 0===an?void 0:an.uuid)===e.uuid,selected:an?!!(0,q.sE)(vn,(function(n){return n.uuid===e.uuid})):(null===P||void 0===P?void 0:P.uuid)===e.uuid},t),{},{children:[An(e),(null===an||void 0===an?void 0:an.uuid)===e.uuid&&" (editing)"]}),e.uuid)})}}))},nodes:Tn,onNodeLink:function(n,e,t,o){var i,r=bn[e.id],u=bn[t.id],c=(null===C||void 0===C?void 0:C.type)===H.q.INTEGRATION&&((null===r||void 0===r?void 0:r.type)===m.tf.DATA_EXPORTER||(null===r||void 0===r?void 0:r.type)===m.tf.DATA_LOADER&&(null===u||void 0===u?void 0:u.type)===m.tf.DATA_EXPORTER);null!==r&&void 0!==r&&null!==(i=r.upstream_blocks)&&void 0!==i&&i.includes(u.uuid)||e.id===t.id||c||On({fromBlock:r,toBlock:u})},onNodeLinkCheck:function(n,e,t){return!In.some((function(n){return n.from===e.id&&n.to===t.id}))},selections:J,zoomable:!0})})]})}},66050:function(n,e,t){var o;t.d(e,{V:function(){return o}}),function(n){n.CANCELLED="cancelled",n.COMPLETED="completed",n.FAILED="failed",n.INITIAL="initial",n.RUNNING="running"}(o||(o={}))},87323:function(n,e,t){t.d(e,{cU:function(){return u}});var o=t(82684),i=t(24224);function r(n,e){return function(n,e,t){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{includeAllNodes:!1},r=(0,i.HK)(t,(function(n){return n.uuid})),u=(o||{}).includeAllNodes,c=[];function l(t){if(t){var o=(t[e]||[]).reduce((function(e,t){return n.uuid===t?e:e.concat(r[t])}),[]);(0===o.length||u&&n.uuid!==t.uuid)&&c.push(t),o.forEach((function(n){l(n)}))}}return l(n),c}(n,"upstream_blocks",e,{includeAllNodes:!0})}function u(n,e){return(0,o.useMemo)((function(){return n.map((function(n){var t=function(n,e){var t=r(n,e);return{dynamicUpstreamBlock:t.find((function(e){var t=e.configuration,o=e.uuid;return(null===t||void 0===t?void 0:t.dynamic)&&o!==(null===n||void 0===n?void 0:n.uuid)})),reduceOutputUpstreamBlock:t.find((function(e){var t=e.configuration,o=e.uuid;return(null===t||void 0===t?void 0:t.reduce_output)&&o!==(null===n||void 0===n?void 0:n.uuid)}))}}(n,e),o=t.dynamicUpstreamBlock,i=t.reduceOutputUpstreamBlock,u=(n||{}).configuration||{};return{block:n,dynamic:!!u.dynamic,dynamicUpstreamBlock:o,reduceOutput:!!u.reduce_output,reduceOutputUpstreamBlock:i}}))}),[e,null===e||void 0===e?void 0:e.map((function(n){var e=n.configuration;return null===e||void 0===e?void 0:e.dynamic})),null===e||void 0===e?void 0:e.map((function(n){var e=n.configuration;return null===e||void 0===e?void 0:e.reduce_output})),null===e||void 0===e?void 0:e.map((function(n){return n.upstream_blocks}))])}},25958:function(n,e,t){function o(n,e){var t,o=null===e||void 0===e?void 0:e.fullPath,i=null===n||void 0===n||null===(t=n.configuration)||void 0===t?void 0:t.file_path;if(o)return null===n||void 0===n?void 0:n.uuid;if(i){var r=i.split("/"),u=r[r.length-1].split(".");return u.pop(),u.join(".")}}t.d(e,{$:function(){return o}})}}]);